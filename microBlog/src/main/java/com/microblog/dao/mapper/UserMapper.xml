<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.microblog.dao.mapper.UserMapper">

	<!-- 注册时提供一个功能： 用户名不能重名 -->
	<select id="getUserByTelephone" resultType="User" parameterType="User">
		select * from users where telephone = #{telephone}
	</select>
	
	<select id="getUserByEmail" resultType="User" parameterType="User">
		select * from users where email = #{email}
	</select>
	
	<select id="getUserByLogin1" resultType="User" parameterType="User">
		select * from users where email = #{email} and password = #{password}
	</select>
	
	<select id="getUserByLogin2" resultType="User" parameterType="User">
		select * from users where telephone = #{telephone} and password = #{password}
	</select>
	
	<select id="getUser" resultType="User">
		select * from users where uid = #{uid}
	</select>
	
	<insert id="saveUser" parameterType="User">
		<selectKey keyProperty="id" order="BEFORE" resultType="Integer">
			select max(id)+1 as uid from users
		</selectKey>
		insert into users values(#{uid}, #{email}, #{password},
		<choose>
			<when test="username != null">#{telephone}</when>
			<otherwise>''</otherwise>
		</choose>
		 , #{nickname}) 
		)
	</insert>
	
	<update id="updateUser" parameterType="User">
	update Users set nickname=
	<choose>
		<when test="nickname !=null">#{nickname}</when>
		<otherwise>null</otherwise>
	</choose>
	,pic=
	<choose>
		<when test="pic !=null">#{pic}</when>
		<otherwise>null</otherwise>
	</choose>
	,sex=
	<choose>
		<when test="sex !=null">#{sex}</when>
		<otherwise>null</otherwise>
	</choose>
	,birthday=
	<choose>
		<when test="birthday !=null">#{birthday}</when>
		<otherwise>null</otherwise>
	</choose>
	where uid=#{uid}
	
	</update>
	
	
</mapper>